<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>é«˜è€ƒç¥ˆç¦ - è€ƒç”Ÿç®¡ç†</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* iPhone 15 Pro Max å¤–å£³ */
        .phone-container {
            width: 393px;
            height: 852px;
            margin: 20px auto;
            position: relative;
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            border-radius: 55px;
            padding: 8px;
            box-shadow:
                0 0 30px rgba(255, 215, 0, 0.1),
                inset 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            border-radius: 47px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(135deg,
                    #0f0f23 0%,
                    #1a1a2e 30%,
                    #16213e 60%,
                    #0f0f23 100%);
        }

        /* æ¯•ä¸šå¸½ç²’å­èƒŒæ™¯ */
        .graduation-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            opacity: 0.2;
            pointer-events: none;
        }

        .graduation-particle {
            position: absolute;
            color: #FFD700;
            font-size: 16px;
            opacity: 0.4;
            animation: floatGraduation 10s infinite ease-in-out;
        }

        .graduation-particle:nth-child(1) {
            left: 15%;
            animation-delay: 0s;
        }

        .graduation-particle:nth-child(2) {
            left: 45%;
            animation-delay: 2s;
        }

        .graduation-particle:nth-child(3) {
            left: 75%;
            animation-delay: 4s;
        }

        .graduation-particle:nth-child(4) {
            left: 30%;
            animation-delay: 6s;
        }

        .graduation-particle:nth-child(5) {
            left: 60%;
            animation-delay: 8s;
        }

        @keyframes floatGraduation {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }

            20% {
                opacity: 0.6;
            }

            80% {
                opacity: 0.3;
            }

            100% {
                transform: translateY(-20px) rotate(360deg);
                opacity: 0;
            }
        }

        /* çŠ¶æ€æ  */
        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 47px;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), transparent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            z-index: 100;
        }

        .time {
            letter-spacing: 0.5px;
        }

        .status-icons {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-icons i {
            font-size: 16px;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .top-nav {
            position: absolute;
            top: 47px;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .nav-back {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-back:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .nav-title {
            font-size: 18px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .add-student-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: linear-gradient(135deg, #FFD700, #FF8C42);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0f0f23;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .add-student-btn:hover {
            transform: scale(1.05);
        }

        .nav-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-action-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        /* æœç´¢æ  */
        .search-section {
            position: absolute;
            top: 107px;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            background: rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
            z-index: 90;
        }

        .search-container {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            height: 40px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 0 40px 0 16px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            border-color: #FFD700;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
        }

        /* ç»Ÿè®¡åŒºåŸŸ */
        .stats-section {
            position: absolute;
            top: 217px;
            left: 0;
            right: 0;
            height: 80px;
            margin-top: 8px;
            padding: 0 24px;
            display: flex;
            align-items: center;
            z-index: 80;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px;
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            gap: 16px;
            width: 100%;
        }

        .stat-item {
            flex: 1;
            text-align: center;
        }

        .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: #FFD700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .stat-divider {
            width: 1px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            position: relative;
            z-index: 10;
            height: calc(100% - 297px);
            margin-top: 300px;
            overflow-y: auto;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .main-content::-webkit-scrollbar {
            width: 0;
        }

        /* è€ƒç”Ÿåˆ—è¡¨ */
        .student-list {
            padding: 20px 24px 100px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .student-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .student-card:hover {
            border-color: rgba(255, 215, 0, 0.3);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .student-card.vip {
            border: 2px solid rgba(255, 215, 0, 0.5);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 66, 0.1));
        }

        .student-card.vip::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #FFD700, #FF8C42, #FFD700);
        }

        .vip-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #FFD700, #FF8C42);
            color: #0f0f23;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }

        .student-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .student-avatar {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: linear-gradient(135deg, #FFD700, #FF8C42);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0f0f23;
            font-size: 24px;
            font-weight: 700;
            position: relative;
        }

        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            background: #4CAF50;
            border: 2px solid #0f0f23;
            border-radius: 8px;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-size: 18px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 4px;
        }

        .student-school {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 4px;
        }

        .countdown-text {
            font-size: 12px;
            color: #FFD700;
            background: rgba(255, 215, 0, 0.15);
            padding: 2px 8px;
            border-radius: 8px;
            display: inline-block;
        }

        .student-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .mini-stat {
            text-align: center;
        }

        .mini-stat-number {
            font-size: 16px;
            font-weight: 600;
            color: #FFD700;
        }

        .mini-stat-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
        }

        .student-actions {
            display: flex;
            gap: 12px;
        }

        .action-button {
            flex: 1;
            height: 36px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .primary-btn {
            background: linear-gradient(135deg, #FFD700, #FF8C42);
            color: #0f0f23;
        }

        .primary-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
        }

        .secondary-btn {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.8);
        }

        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .danger-btn {
            background: rgba(244, 67, 54, 0.15);
            border-color: rgba(244, 67, 54, 0.3);
            color: rgba(244, 67, 54, 0.9);
            flex: 0.8;
        }

        .danger-btn:hover {
            background: rgba(244, 67, 54, 0.25);
            border-color: rgba(244, 67, 54, 0.5);
            color: #f44336;
            transform: translateY(-1px);
        }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 83px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            padding: 0 24px 34px;
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-item.active .nav-icon {
            color: #FFD700;
            transform: scale(1.1);
        }

        .nav-item.active .nav-label {
            color: #FFD700;
        }

        .nav-icon {
            font-size: 22px;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .nav-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 80px 24px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-text {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .empty-subtitle {
            font-size: 14px;
            opacity: 0.7;
            margin-bottom: 24px;
        }

        .empty-action {
            background: linear-gradient(135deg, #FFD700, #FF8C42);
            color: #0f0f23;
            padding: 12px 24px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .empty-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        /* æ‰¹é‡æ“ä½œæ ·å¼ */
        .batch-mode .student-card {
            cursor: pointer;
            position: relative;
        }

        .batch-mode .student-card::before {
            content: '';
            position: absolute;
            top: 12px;
            left: 12px;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .batch-mode .student-card.selected::before {
            background: #FFD700;
            border-color: #FFD700;
        }

        .batch-mode .student-card.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 15px;
            left: 15px;
            color: #0f0f23;
            font-size: 12px;
            font-weight: bold;
        }

        .batch-mode .student-card.selected {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
            transform: scale(0.98);
        }

        /* æ‰¹é‡æ“ä½œå·¥å…·æ  */
        .batch-toolbar {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 35, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 12px 20px;
            display: flex;
            gap: 12px;
            backdrop-filter: blur(20px);
            z-index: 1000;
            opacity: 0;
            animation: slideUpFade 0.3s ease forwards;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .batch-toolbar button {
            padding: 8px 16px;
            border: none;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .batch-toolbar .delete-btn {
            background: rgba(244, 67, 54, 0.8);
            color: white;
        }

        .batch-toolbar .cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }

        .batch-toolbar .export-btn {
            background: rgba(76, 175, 80, 0.8);
            color: white;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-height: 900px) {
            .phone-container {
                transform: scale(0.9);
                margin: 10px auto;
            }
        }

        /* æ‹–æ‹½æ’åºæ ·å¼ */
        .student-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
        }

        .drag-indicator {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.3);
            cursor: grab;
            font-size: 16px;
        }

        .drag-indicator:active {
            cursor: grabbing;
        }

        /* é«˜çº§æœç´¢æ ·å¼ */
        .filter-pills {
            display: flex;
            gap: 8px;
            padding: 8px 24px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .filter-pills::-webkit-scrollbar {
            display: none;
        }

        .filter-pill {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 6px 12px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .filter-pill.active {
            background: linear-gradient(135deg, #FFD700, #FF8C42);
            color: #0f0f23;
            border-color: transparent;
        }

        .filter-pill:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* æ‹–æ‹½æ’åºæ ·å¼ */
        .student-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
        }

        .drag-indicator {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.3);
            cursor: grab;
            font-size: 16px;
        }

        .drag-indicator:active {
            cursor: grabbing;
        }

        /* ç­›é€‰æ¡ä»¶åŒºåŸŸ */
        .filter-section {
            position: absolute;
            top: 167px;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
            z-index: 70;
            display: flex;
            align-items: center;
        }

        /* é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ */
        .high-contrast .student-card {
            border: 2px solid #ffffff;
            background: #000000;
            color: #ffffff;
        }

        .high-contrast .student-card:hover {
            border-color: #ffff00;
            background: #333333;
        }

        .high-contrast .action-button {
            border: 2px solid #ffffff;
            font-weight: bold;
        }

        .high-contrast .primary-btn {
            background: #ffff00;
            color: #000000;
        }

        .high-contrast .danger-btn {
            background: #ff0000;
            color: #ffffff;
        }

        /* ç„¦ç‚¹æŒ‡ç¤ºå™¨å¢å¼º */
        .student-card:focus {
            outline: 3px solid #FFD700;
            outline-offset: 2px;
        }

        .filter-pill:focus,
        .action-button:focus,
        .nav-item:focus {
            outline: 2px solid #FFD700;
            outline-offset: 1px;
        }

        /* åŠ¨ç”»æ€§èƒ½ä¼˜åŒ– */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="phone-screen">
            <!-- iOS çŠ¶æ€æ  -->
            <div class="status-bar">
                <div class="time">9:41</div>
                <div class="status-icons">
                    <i class="fas fa-signal"></i>
                    <i class="fas fa-wifi"></i>
                    <i class="fas fa-battery-three-quarters"></i>
                </div>
            </div>

            <!-- æ¯•ä¸šå¸½ç²’å­èƒŒæ™¯ -->
            <div class="graduation-particles">
                <div class="graduation-particle">ğŸ“</div>
                <div class="graduation-particle">ğŸ“š</div>
                <div class="graduation-particle">âœï¸</div>
                <div class="graduation-particle">ğŸ†</div>
                <div class="graduation-particle">ğŸŒŸ</div>
            </div>

            <!-- é¡¶éƒ¨å¯¼èˆª -->
            <div class="top-nav">
                <div class="nav-back" onclick="goBack()">
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="nav-title">è€ƒç”Ÿç®¡ç†</div>
                <div class="nav-actions" style="display: flex; gap: 8px;">
                    <div class="nav-action-btn" onclick="showImportDialog()" title="å¯¼å…¥æ•°æ®">
                        <i class="fas fa-upload" style="font-size: 16px; color: rgba(255, 255, 255, 0.8);"></i>
                    </div>
                    <div class="add-student-btn" onclick="addStudent()">
                        <i class="fas fa-plus"></i>
                    </div>
                </div>
            </div> <!-- æœç´¢æ  -->
            <div class="search-section">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="æœç´¢è€ƒç”Ÿå§“åæˆ–å­¦æ ¡" id="searchInput"
                        oninput="searchStudents()">
                    <i class="fas fa-search search-icon"></i>
                </div>
            </div>

            <!-- ç­›é€‰æ¡ä»¶åŒºåŸŸ -->
            <div class="filter-section">
                <div class="filter-pills">
                    <div class="filter-pill active" data-filter="all">å…¨éƒ¨</div>
                    <div class="filter-pill" data-filter="ç†ç§‘">ç†ç§‘</div>
                    <div class="filter-pill" data-filter="æ–‡ç§‘">æ–‡ç§‘</div>
                    <div class="filter-pill" data-filter="è‰ºæœ¯">è‰ºæœ¯</div>
                    <div class="filter-pill" data-filter="ä½“è‚²">ä½“è‚²</div>
                    <div class="filter-pill" data-filter="å…³æ³¨">å·²å…³æ³¨</div>
                </div>
            </div>

            <!-- ç»Ÿè®¡åŒºåŸŸ -->
            <div class="stats-section">
                <div class="stats-card">
                    <div class="stat-item">
                        <div class="stat-number">12</div>
                        <div class="stat-label">å…³æ³¨è€ƒç”Ÿ</div>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <div class="stat-number">36</div>
                        <div class="stat-label">å€’è®¡æ—¶å¤©æ•°</div>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <div class="stat-number">156</div>
                        <div class="stat-label">æ€»ç¥ç¦æ•°</div>
                    </div>
                </div>
            </div>

            <!-- ä¸»å†…å®¹ -->
            <div class="main-content">
                <div class="student-list" id="studentList">
                    <!-- å­¦ç”Ÿå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€æ¸²æŸ“ -->
                </div>
            </div>

            <!-- åº•éƒ¨å¯¼èˆª -->
            <div class="bottom-nav">
                <div class="nav-item" onclick="goToHome()">
                    <div class="nav-icon"><i class="fas fa-home"></i></div>
                    <div class="nav-label">é¦–é¡µ</div>
                </div>
                <div class="nav-item" onclick="goToBlessingWall()">
                    <div class="nav-icon"><i class="fas fa-comments"></i></div>
                    <div class="nav-label">ç¥ˆç¦å¢™</div>
                </div>
                <div class="nav-item active">
                    <div class="nav-icon"><i class="fas fa-users"></i></div>
                    <div class="nav-label">è€ƒç”Ÿ</div>
                </div>
                <div class="nav-item" onclick="goToProfile()">
                    <div class="nav-icon"><i class="fas fa-user"></i></div>
                    <div class="nav-label">æˆ‘çš„</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== æ•°æ®åŒæ­¥å’Œæ£€æŸ¥åŠŸèƒ½ =====
        const DataSyncManager = {
            // æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
            checkDataConsistency() {
                const students = localStorage.getItem('blessing_students');
                const records = localStorage.getItem('blessing_records');
                const preferences = localStorage.getItem('blessing_user_preferences');

                const report = {
                    studentsExists: !!students,
                    recordsExists: !!records,
                    preferencesExists: !!preferences,
                    studentsCount: students ? JSON.parse(students).length : 0,
                    recordsCount: records ? JSON.parse(records).length : 0
                };

                console.log('ğŸ“Š æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥:', report);
                return report;
            },

            // ä¿®å¤æ•°æ®ç»“æ„
            fixDataStructure() {
                try {
                    // ç¡®ä¿æ‰€æœ‰å¿…è¦çš„å­˜å‚¨é”®éƒ½å­˜åœ¨
                    const students = StudentDataManager.getStudentData();
                    const records = JSON.parse(localStorage.getItem('blessing_records') || '[]');
                    const preferences = JSON.parse(localStorage.getItem('blessing_user_preferences') || '{}');

                    // æ ‡å‡†åŒ–å­¦ç”Ÿæ•°æ®ç»“æ„
                    const standardizedStudents = students.map(student => ({
                        id: student.id || Date.now() + Math.random(),
                        name: student.name || 'æœªçŸ¥å­¦ç”Ÿ',
                        school: student.school || 'æœªçŸ¥å­¦æ ¡',
                        grade: student.grade || 'é«˜ä¸‰',
                        subjects: student.subjects || 'æ–‡ç†ç»¼åˆ',
                        avatar: student.avatar || student.name?.charAt(0) || '?',
                        blessingCount: student.blessingCount || 0,
                        averageScore: student.averageScore || 'å¾…å½•å…¥',
                        examRank: student.examRank || 'å¾…æµ‹è¯•',
                        countdownDays: student.countdownDays || 36,
                        isVip: student.isVip || false,
                        isOnline: student.isOnline !== false,
                        lastActive: student.lastActive || new Date().toISOString(),
                        joinDate: student.joinDate || new Date().toISOString()
                    }));

                    // ä¿å­˜æ ‡å‡†åŒ–æ•°æ®
                    StudentDataManager.saveStudentData(standardizedStudents);

                    showToast('æ•°æ®ç»“æ„å·²ä¿®å¤', 'success', 2000);
                    console.log('âœ… æ•°æ®ç»“æ„å·²æ ‡å‡†åŒ–');

                    return true;
                } catch (error) {
                    console.error('âŒ æ•°æ®ä¿®å¤å¤±è´¥:', error);
                    showToast('æ•°æ®ä¿®å¤å¤±è´¥', 'error', 3000);
                    return false;
                }
            },

            // æ•°æ®åŒæ­¥åˆ°å…¶ä»–é¡µé¢
            syncToAllPages() {
                try {
                    const students = StudentDataManager.getStudentData();

                    // è§¦å‘å­˜å‚¨äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–æ‰“å¼€çš„é¡µé¢
                    window.dispatchEvent(new StorageEvent('storage', {
                        key: 'blessing_students',
                        oldValue: null,
                        newValue: JSON.stringify(students),
                        url: window.location.href,
                        storageArea: localStorage
                    }));

                    console.log('ğŸ”„ å·²è§¦å‘æ•°æ®åŒæ­¥äº‹ä»¶');
                    return true;
                } catch (error) {
                    console.error('âŒ æ•°æ®åŒæ­¥å¤±è´¥:', error);
                    return false;
                }
            }
        };

        // ===== æ•°æ®ç®¡ç†å™¨ =====
        const StudentDataManager = {
            // è·å–å­¦ç”Ÿæ•°æ®
            getStudentData() {
                try {
                    const saved = localStorage.getItem('blessing_students');
                    return saved ? JSON.parse(saved) : this.getDefaultStudents();
                } catch (e) {
                    console.warn('æ— æ³•è·å–å­¦ç”Ÿæ•°æ®:', e);
                    return this.getDefaultStudents();
                }
            },

            // ä¿å­˜å­¦ç”Ÿæ•°æ®
            saveStudentData(students) {
                try {
                    localStorage.setItem('blessing_students', JSON.stringify(students));
                    console.log('âœ… å­¦ç”Ÿæ•°æ®å·²ä¿å­˜');
                } catch (e) {
                    console.warn('âš ï¸ æ— æ³•ä¿å­˜å­¦ç”Ÿæ•°æ®:', e);
                }
            },

            // è·å–é»˜è®¤å­¦ç”Ÿæ•°æ®
            getDefaultStudents() {
                return [{
                    id: 1,
                    name: 'ææ˜',
                    school: 'åŒ—äº¬å¸‚ç¬¬ä¸€ä¸­å­¦',
                    grade: 'é«˜ä¸‰(1)ç­',
                    subjects: 'ç†ç§‘',
                    avatar: 'æ',
                    examDate: '2025-06-07',
                    isVip: true,
                    isOnline: true,
                    blessingCount: 42,
                    averageScore: 98,
                    examRank: 3,
                    countdownDays: 36,
                    isFollowed: true
                },
                {
                    id: 2,
                    name: 'ç‹å°å',
                    school: 'ä¸Šæµ·å¸‚å®éªŒä¸­å­¦',
                    grade: 'é«˜ä¸‰(2)ç­',
                    subjects: 'æ–‡ç§‘',
                    avatar: 'ç‹',
                    examDate: '2025-06-07',
                    isVip: false,
                    isOnline: true,
                    blessingCount: 28,
                    averageScore: 92,
                    examRank: 8,
                    countdownDays: 36
                },
                {
                    id: 3,
                    name: 'å¼ å°èŒ',
                    school: 'å¹¿å·å¸‚é‡ç‚¹ä¸­å­¦',
                    grade: 'é«˜ä¸‰(3)ç­',
                    subjects: 'ç†ç§‘',
                    avatar: 'å¼ ',
                    examDate: '2025-06-07',
                    isVip: false,
                    isOnline: false,
                    blessingCount: 35,
                    averageScore: 95,
                    examRank: 5,
                    countdownDays: 36
                },
                {
                    id: 4,
                    name: 'é™ˆæµ©ç„¶',
                    school: 'æ·±åœ³å¤–å›½è¯­å­¦æ ¡',
                    grade: 'é«˜ä¸‰(4)ç­',
                    subjects: 'ç†ç§‘',
                    avatar: 'é™ˆ',
                    examDate: '2025-06-07',
                    isVip: false,
                    isOnline: true,
                    blessingCount: 21,
                    averageScore: 89,
                    examRank: 12,
                    countdownDays: 36
                },
                {
                    id: 5,
                    name: 'åˆ˜è‰ºæ¶µ',
                    school: 'æ­å·è‰ºæœ¯å­¦æ ¡',
                    grade: 'é«˜ä¸‰(5)ç­',
                    subjects: 'è‰ºæœ¯',
                    avatar: 'åˆ˜',
                    examDate: '2025-06-07',
                    isVip: true,
                    isOnline: true,
                    blessingCount: 33,
                    averageScore: 91,
                    examRank: 7,
                    countdownDays: 36,
                    isFollowed: true
                },
                {
                    id: 6,
                    name: 'æ—ä½“å¼º',
                    school: 'æˆéƒ½ä½“è‚²ä¸­å­¦',
                    grade: 'é«˜ä¸‰(6)ç­',
                    subjects: 'ä½“è‚²',
                    avatar: 'æ—',
                    examDate: '2025-06-07',
                    isVip: false,
                    isOnline: true,
                    blessingCount: 25,
                    averageScore: 85,
                    examRank: 15,
                    countdownDays: 36
                }
                ];
            },

            // æ›´æ–°å­¦ç”Ÿç¥ç¦æ•°é‡
            updateBlessingCount(studentName, increment = 1) {
                const students = this.getStudentData();
                const student = students.find(s => s.name === studentName || s.name === studentName + 'åŒå­¦');
                if (student) {
                    student.blessingCount += increment;
                    this.saveStudentData(students);
                    return student;
                }
                return null;
            },

            // æ·»åŠ æ–°å­¦ç”Ÿ
            addStudent(studentData) {
                const students = this.getStudentData();
                const newStudent = {
                    id: Date.now(),
                    blessingCount: 0,
                    countdownDays: 36,
                    isVip: false,
                    isOnline: true,
                    ...studentData
                };
                students.push(newStudent);
                this.saveStudentData(students);
                return newStudent;
            },

            // åˆ é™¤å­¦ç”Ÿ
            removeStudent(studentId) {
                const students = this.getStudentData();
                const filteredStudents = students.filter(s => s.id !== studentId);
                this.saveStudentData(filteredStudents);
                return filteredStudents;
            },

            // è·å–ç»Ÿè®¡æ•°æ®
            getStatistics() {
                const students = this.getStudentData();
                return {
                    totalStudents: students.length,
                    totalBlessings: students.reduce((sum, s) => sum + s.blessingCount, 0),
                    vipStudents: students.filter(s => s.isVip).length,
                    onlineStudents: students.filter(s => s.isOnline).length
                };
            }
        };
        
        // å…¨å±€å˜é‡
        let studentsData = [];
        let filteredStudents = [];
        let currentFilter = 'all';

        // ===== é«˜çº§ç­›é€‰åŠŸèƒ½ =====
        function applyFilter(filterType) {
            currentFilter = filterType;

            // æ›´æ–°ç­›é€‰æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.filter-pill').forEach(pill => {
                pill.classList.toggle('active', pill.dataset.filter === filterType);
            });
            
            // åº”ç”¨ç­›é€‰æ¡ä»¶
            switch (filterType) {
                case 'all':
                    filteredStudents = [...studentsData];
                    break;
                case 'ç†ç§‘':
                    filteredStudents = studentsData.filter(s => s.subjects === 'ç†ç§‘' || s.type === 'ç†ç§‘');
                    break;
                case 'æ–‡ç§‘':
                    filteredStudents = studentsData.filter(s => s.subjects === 'æ–‡ç§‘' || s.type === 'æ–‡ç§‘');
                    break;
                case 'è‰ºæœ¯':
                    filteredStudents = studentsData.filter(s => s.subjects === 'è‰ºæœ¯' || s.type === 'è‰ºæœ¯');
                    break;
                case 'ä½“è‚²':
                    filteredStudents = studentsData.filter(s => s.subjects === 'ä½“è‚²' || s.type === 'ä½“è‚²');
                    break;
                case 'å…³æ³¨':
                    filteredStudents = studentsData.filter(s => s.isFollowed || s.isVip);
                    break;
                default:
                    filteredStudents = [...studentsData];
            }

            // å¦‚æœæœ‰æœç´¢æ¡ä»¶ï¼ŒåŒæ—¶åº”ç”¨æœç´¢
            const searchValue = document.getElementById('searchInput').value;
            if (searchValue.trim()) {
                applySearch(searchValue, false);
            } else {
                renderStudentList();
            }

            showToast(`ç­›é€‰ç»“æœï¼š${filteredStudents.length} ä½è€ƒç”Ÿ`);
        }

        // ===== æ‹–æ‹½æ’åºåŠŸèƒ½ =====
        let draggedElement = null;
        let draggedIndex = -1;

        function enableDragSort() {
            document.querySelectorAll('.student-card').forEach((card, index) => {
                // æ·»åŠ æ‹–æ‹½æŒ‡ç¤ºå™¨
                if (!card.querySelector('.drag-indicator')) {
                    const indicator = document.createElement('div');
                    indicator.className = 'drag-indicator';
                    indicator.innerHTML = '<i class="fas fa-grip-vertical"></i>';
                    card.insertBefore(indicator, card.firstChild);
                }

                card.draggable = true;
                card.addEventListener('dragstart', (e) => {
                    draggedElement = card;
                    draggedIndex = index;
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    draggedElement = null;
                    draggedIndex = -1;
                });

                card.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });

                card.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedElement && draggedElement !== card) {
                        const cards = Array.from(document.querySelectorAll('.student-card'));
                        const dropIndex = cards.indexOf(card);

                        // é‡æ–°æ’åºæ•°æ®
                        const [movedStudent] = filteredStudents.splice(draggedIndex, 1);
                        filteredStudents.splice(dropIndex, 0, movedStudent);

                        // æ›´æ–°ä¸»æ•°æ®
                        studentsData = [...filteredStudents];
                        StudentDataManager.saveStudentData(studentsData);

                        renderStudentList();
                        showToast('æ’åºå·²æ›´æ–°', 'success');
                    }
                });
            });
        }

        // é¡µé¢åŠ è½½åŠ¨ç”»
        window.addEventListener('load', function () {
            document.body.style.opacity = '1';

            // æ‰§è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
            DataSyncManager.checkDataConsistency();

            // ä¿®å¤æ•°æ®ç»“æ„ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
            DataSyncManager.fixDataStructure();

            initializePage();
        });

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            loadStudentsData();
            renderStudentList();
            updateStatistics();
            initializeEventListeners();
        }

        // åŠ è½½å­¦ç”Ÿæ•°æ®
        function loadStudentsData() {
            studentsData = StudentDataManager.getStudentData();
            filteredStudents = [...studentsData];
            console.log('ğŸ“š å·²åŠ è½½å­¦ç”Ÿæ•°æ®:', studentsData.length, 'ä½å­¦ç”Ÿ');
        }
        
        // æ¸²æŸ“å­¦ç”Ÿåˆ—è¡¨
        function renderStudentList() {
            const container = document.getElementById('studentList');
            if (!container) return;

            if (filteredStudents.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.6);">
                        <i class="fas fa-user-plus" style="font-size: 48px; margin-bottom: 16px; color: #FFD700;"></i>
                        <h3 style="margin: 0 0 8px; color: rgba(255, 255, 255, 0.8);">æš‚æ— è€ƒç”Ÿä¿¡æ¯</h3>
                        <p style="margin: 0; font-size: 14px;">ç‚¹å‡»å³ä¸Šè§’ + å·æ·»åŠ è€ƒç”Ÿ</p>
                    </div>
                `;
                return;
            }

            const studentsHTML = filteredStudents.map(student => `
                <div class="student-card ${student.isVip ? 'vip' : ''}" data-student-id="${student.id}">
                    ${student.isVip ? '<div class="vip-badge">VIP</div>' : ''}
                    <div class="student-header">
                        <div class="student-avatar">
                            ${student.avatar}
                            ${student.isOnline ? '<div class="online-indicator"></div>' : ''}
                        </div>
                        <div class="student-info">
                            <div class="student-name">${student.name}åŒå­¦</div>
                            <div class="student-school">${student.school} Â· ${student.subjects}</div>
                            <div class="countdown-text">è·ç¦»é«˜è€ƒè¿˜æœ‰${student.countdownDays}å¤©</div>
                        </div>
                    </div>
                    <div class="student-stats">
                        <div class="mini-stat">
                            <div class="mini-stat-number">${student.blessingCount}</div>
                            <div class="mini-stat-label">æ”¶åˆ°ç¥ç¦</div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-number">${student.averageScore}</div>
                            <div class="mini-stat-label">å¹³å‡åˆ†</div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-number">${student.examRank}</div>
                            <div class="mini-stat-label">æ¨¡è€ƒæ’å</div>
                        </div>
                    </div>
                    <div class="student-actions">
                        <div class="action-button primary-btn" onclick="sendBlessing('${student.name}')">
                            <i class="fas fa-heart"></i>
                            å‘é€ç¥ç¦
                        </div>
                        <div class="action-button secondary-btn" onclick="viewDetails('${student.name}')">
                            <i class="fas fa-chart-line"></i>
                            æŸ¥çœ‹è¯¦æƒ…
                        </div>
                        <div class="action-button danger-btn" onclick="removeStudent('${student.id}', '${student.name}')">
                            <i class="fas fa-trash"></i>
                            åˆ é™¤
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = studentsHTML;

            // é‡æ–°ç»‘å®šäº‹ä»¶
            bindStudentCardEvents();
            enableDragSort();
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatistics() {
            const stats = StudentDataManager.getStatistics();

            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
            const statElements = document.querySelectorAll('.stat-number');
            if (statElements.length >= 3) {
                statElements[0].textContent = stats.totalStudents;
                statElements[1].textContent = 36; // å€’è®¡æ—¶å¤©æ•°å›ºå®š
                statElements[2].textContent = stats.totalBlessings;
            }

            console.log('ğŸ“Š ç»Ÿè®¡æ•°æ®å·²æ›´æ–°:', stats);
        }

        // ç»‘å®šå­¦ç”Ÿå¡ç‰‡äº‹ä»¶
        function bindStudentCardEvents() {
            document.querySelectorAll('.student-card').forEach(card => {
                card.addEventListener('mouseenter', function () {
                    this.style.transform = 'translateY(-4px) scale(1.02)';
                    this.style.boxShadow = '0 15px 40px rgba(255, 215, 0, 0.2)';
                });

                card.addEventListener('mouseleave', function () {
                    this.style.transform = '';
                    this.style.boxShadow = '';
                });
            });
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initializeEventListeners() {
            // æœç´¢æ¡†äº‹ä»¶
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('focus', function () {
                    this.parentElement.style.transform = 'scale(1.02)';
                });

                searchInput.addEventListener('blur', function () {
                    this.parentElement.style.transform = '';
                });
            }

            // ç­›é€‰æ¡ä»¶äº‹ä»¶
            const filterPills = document.querySelectorAll('.filter-pill');
            filterPills.forEach(pill => {
                pill.addEventListener('click', function () {
                    const filterType = this.dataset.filter;
                    applyFilter(filterType);
                });
            });
        }

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            showToast('è¿”å›ä¸Šä¸€é¡µ...');
            pageTransition('blessing-main.html');
        }

        // ===== æ•°æ®å¯¼å…¥åŠŸèƒ½ =====
        function showImportDialog() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(10px);
            `;

            modal.innerHTML = `
                <div style="
                    background: rgba(15, 15, 35, 0.95);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 16px;
                    padding: 24px;
                    width: 90%;
                    max-width: 400px;
                    backdrop-filter: blur(20px);
                ">
                    <h3 style="margin: 0 0 20px; color: #FFD700; text-align: center;">å¯¼å…¥å­¦ç”Ÿæ•°æ®</h3>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.8); font-size: 14px;">
                            é€‰æ‹©JSONæ–‡ä»¶ï¼š
                        </label>
                        <input type="file" id="importFile" accept=".json" style="
                            width: 100%;
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            color: white;
                            font-size: 14px;
                        ">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.8); font-size: 14px;">
                            æˆ–ç²˜è´´JSONæ•°æ®ï¼š
                        </label>
                        <textarea id="importData" placeholder="ç²˜è´´å­¦ç”Ÿæ•°æ®çš„JSONæ ¼å¼..." style="
                            width: 100%;
                            height: 120px;
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            color: white;
                            font-size: 12px;
                            resize: vertical;
                            font-family: monospace;
                        "></textarea>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button onclick="closeImportDialog()" style="
                            flex: 1;
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.1);
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            border-radius: 8px;
                            color: rgba(255, 255, 255, 0.7);
                            cursor: pointer;
                        ">å–æ¶ˆ</button>
                        <button onclick="processImport()" style="
                            flex: 1;
                            padding: 12px;
                            background: linear-gradient(135deg, #FFD700, #FF8C42);
                            border: none;
                            border-radius: 8px;
                            color: #0f0f23;
                            font-weight: 600;
                            cursor: pointer;
                        ">å¯¼å…¥</button>
                    </div>
                </div>
            `;

            modal.onclick = (e) => {
                if (e.target === modal) closeImportDialog();
            };

            document.body.appendChild(modal);

            // æ–‡ä»¶é€‰æ‹©å¤„ç†
            document.getElementById('importFile').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('importData').value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });

            window.closeImportDialog = function () {
                modal.remove();
            };

            window.processImport = function () {
                const data = document.getElementById('importData').value.trim();
                if (!data) {
                    showToast('è¯·é€‰æ‹©æ–‡ä»¶æˆ–ç²˜è´´æ•°æ®', 'warning');
                    return;
                }

                if (AdvancedDataManager.importData(data)) {
                    closeImportDialog();
                }
            };
        }

        // æ·»åŠ å­¦ç”Ÿ - å¢å¼ºåŠŸèƒ½
        function addStudent() {
            // è·å–æ‰‹æœºå±å¹•å®¹å™¨
            const phoneScreen = document.querySelector('.phone-screen');

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(10px);
                border-radius: 47px;
            `;

            modal.innerHTML = `
                <div style="
                    background: rgba(15, 15, 35, 0.95);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 16px;
                    padding: 24px;
                    width: 85%;
                    max-width: 320px;
                    max-height: 80vh;
                    overflow-y: auto;
                    backdrop-filter: blur(20px);
                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
                ">
                    <h3 style="margin: 0 0 20px; color: #FFD700; text-align: center; font-size: 18px;">æ·»åŠ è€ƒç”Ÿ</h3>
                    <form id="addStudentForm" style="display: flex; flex-direction: column; gap: 14px;">
                        <input type="text" id="studentName" placeholder="å§“å" required style="
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            color: white;
                            font-size: 14px;
                            outline: none;
                            transition: border-color 0.3s ease;
                        " onfocus="this.style.borderColor='rgba(255, 215, 0, 0.5)'" onblur="this.style.borderColor='rgba(255, 255, 255, 0.1)'">
                        <input type="text" id="studentSchool" placeholder="å­¦æ ¡" required style="
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            color: white;
                            font-size: 14px;
                            outline: none;
                            transition: border-color 0.3s ease;
                        " onfocus="this.style.borderColor='rgba(255, 215, 0, 0.5)'" onblur="this.style.borderColor='rgba(255, 255, 255, 0.1)'">
                        <input type="text" id="studentGrade" placeholder="ç­çº§ (å¦‚: é«˜ä¸‰(1)ç­)" required style="
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            color: white;
                            font-size: 14px;
                            outline: none;
                            transition: border-color 0.3s ease;
                        " onfocus="this.style.borderColor='rgba(255, 215, 0, 0.5)'" onblur="this.style.borderColor='rgba(255, 255, 255, 0.1)'">
                        <select id="studentSubjects" required style="
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            color: white;
                            font-size: 14px;
                            outline: none;
                            transition: border-color 0.3s ease;
                        " onfocus="this.style.borderColor='rgba(255, 215, 0, 0.5)'" onblur="this.style.borderColor='rgba(255, 255, 255, 0.1)'">
                            <option value="" style="background: rgba(15, 15, 35, 0.95); color: white;">é€‰æ‹©ç§‘ç›®ç±»åˆ«</option>
                            <option value="ç†ç§‘" style="background: rgba(15, 15, 35, 0.95); color: white;">ç†ç§‘</option>
                            <option value="æ–‡ç§‘" style="background: rgba(15, 15, 35, 0.95); color: white;">æ–‡ç§‘</option>
                            <option value="è‰ºæœ¯" style="background: rgba(15, 15, 35, 0.95); color: white;">è‰ºæœ¯</option>
                            <option value="ä½“è‚²" style="background: rgba(15, 15, 35, 0.95); color: white;">ä½“è‚²</option>
                        </select>
                        <div style="display: flex; gap: 12px; margin-top: 8px;">
                            <button type="button" onclick="closeAddStudentModal()" style="
                                flex: 1;
                                padding: 12px;
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                border-radius: 8px;
                                color: rgba(255, 255, 255, 0.7);
                                cursor: pointer;
                                font-size: 14px;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.background='rgba(255, 255, 255, 0.15)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">å–æ¶ˆ</button>
                            <button type="submit" style="
                                flex: 1;
                                padding: 12px;
                                background: linear-gradient(135deg, #FFD700, #FF8C42);
                                border: none;
                                border-radius: 8px;
                                color: #0f0f23;
                                font-weight: 600;
                                cursor: pointer;
                                font-size: 14px;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">æ·»åŠ </button>
                        </div>
                    </form>
                </div>
            `;

            modal.onclick = (e) => {
                if (e.target === modal) {
                    closeAddStudentModal();
                }
            };

            // å°†å¼¹å‡ºæ¡†æ·»åŠ åˆ°æ‰‹æœºå±å¹•å®¹å™¨å†…ï¼Œè€Œä¸æ˜¯document.body
            phoneScreen.appendChild(modal);

            // æ·»åŠ è¿›å…¥åŠ¨ç”»
            modal.style.animation = 'modalFadeIn 0.3s ease-out';

            // æ·»åŠ CSSåŠ¨ç”»ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!document.querySelector('#modal-animations')) {
                const style = document.createElement('style');
                style.id = 'modal-animations';
                style.textContent = `
                    @keyframes modalFadeIn {
                        from {
                            opacity: 0;
                            transform: scale(0.9);
                        }
                        to {
                            opacity: 1;
                            transform: scale(1);
                        }
                    }
                    @keyframes modalFadeOut {
                        from {
                            opacity: 1;
                            transform: scale(1);
                        }
                        to {
                            opacity: 0;
                            transform: scale(0.9);
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
            document.getElementById('addStudentForm').onsubmit = function (e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const name = document.getElementById('studentName').value.trim();
                const school = document.getElementById('studentSchool').value.trim();
                const grade = document.getElementById('studentGrade').value.trim();
                const subjects = document.getElementById('studentSubjects').value;

                if (!name || !school || !grade || !subjects) {
                    showToast('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', 'error');
                    return;
                }

                const newStudent = StudentDataManager.addStudent({
                    name,
                    school,
                    grade,
                    subjects,
                    avatar: name.charAt(0),
                    examDate: '2025-06-07',
                    averageScore: Math.floor(Math.random() * 20) + 80, // 80-100åˆ†
                    examRank: Math.floor(Math.random() * 20) + 1 // 1-20å
                });

                studentsData = StudentDataManager.getStudentData();
                filteredStudents = [...studentsData];
                renderStudentList();
                updateStatistics(); closeAddStudentModal();
                showToast('æˆåŠŸæ·»åŠ è€ƒç”Ÿ ' + name + '!', 'success');
            };

            window.closeAddStudentModal = function () {
                modal.remove();
            };
        }        // æœç´¢è€ƒç”Ÿ - å¢å¼ºåŠŸèƒ½
        function searchStudents() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase().trim();
            applySearch(searchValue, true);
        }

        function applySearch(searchValue, updateFilter = false) {
            // é¦–å…ˆåº”ç”¨å½“å‰ç­›é€‰æ¡ä»¶
            let baseData = studentsData;
            if (currentFilter !== 'all') {
                switch (currentFilter) {
                    case 'vip':
                        baseData = studentsData.filter(s => s.isVip);
                        break;
                    case 'online':
                        baseData = studentsData.filter(s => s.isOnline);
                        break;
                    case 'ç†ç§‘':
                    case 'æ–‡ç§‘':
                        baseData = studentsData.filter(s => s.subjects === currentFilter);
                        break;
                    case 'high-blessing':
                        baseData = studentsData.filter(s => s.blessingCount >= 30);
                        break;
                }
            }

            // ç„¶ååº”ç”¨æœç´¢æ¡ä»¶
            if (!searchValue) {
                filteredStudents = [...baseData];
            } else {
                filteredStudents = baseData.filter(student =>
                    student.name.toLowerCase().includes(searchValue) ||
                    student.school.toLowerCase().includes(searchValue) ||
                    student.grade.toLowerCase().includes(searchValue) ||
                    student.subjects.toLowerCase().includes(searchValue)
                );
            }

            renderStudentList();

            // æ˜¾ç¤ºæœç´¢ç»“æœæç¤º
            if (searchValue && updateFilter) {
                showToast('æ‰¾åˆ° ' + filteredStudents.length + ' ä½è€ƒç”Ÿ');
            }
        }

        // å‘é€ç¥ç¦ - å¢å¼ºåŠŸèƒ½
        function sendBlessing(studentName) {
            showToast('æ­£åœ¨ä¸º' + studentName + 'å‘é€ç¥ç¦...');

            // æ¨¡æ‹Ÿå‘é€æˆåŠŸåæ›´æ–°ç¥ç¦æ•°é‡
            setTimeout(() => {
                const updatedStudent = StudentDataManager.updateBlessingCount(studentName);

                if (updatedStudent) {
                    // æ›´æ–°UIä¸­çš„ç¥ç¦æ•°é‡
                    const card = document.querySelector('[data-student-id="' + updatedStudent.id + '"]');
                    if (card) {
                        const blessingCount = card.querySelector('.mini-stat-number');
                        blessingCount.textContent = updatedStudent.blessingCount;

                        // æ·»åŠ å‘é€æˆåŠŸçš„è§†è§‰åé¦ˆ
                        const sendBtn = card.querySelector('.primary-btn');
                        const originalText = sendBtn.innerHTML;
                        sendBtn.innerHTML = '<i class="fas fa-check"></i> å·²å‘é€';
                        sendBtn.style.background = '#4CAF50';

                        setTimeout(() => {
                            sendBtn.innerHTML = originalText;
                            sendBtn.style.background = '';
                        }, 2000);
                    }

                    // æ›´æ–°ç»Ÿè®¡æ•°æ®
                    updateStatistics();
                }
                showToast('ç¥ç¦å‘é€æˆåŠŸï¼ğŸ’«', 'success');
            }, 1000);
        }

        // æŸ¥çœ‹è¯¦æƒ…
        function viewDetails(studentName) {
            const student = studentsData.find(s => s.name === studentName);
            if (!student) {
                showToast('æœªæ‰¾åˆ°å­¦ç”Ÿä¿¡æ¯', 'error');
                return;
            }

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(10px);
            `;

            modal.innerHTML = `
                <div style="
                    background: rgba(15, 15, 35, 0.95);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 16px;
                    padding: 24px;
                    width: 90%;
                    max-width: 400px;
                    backdrop-filter: blur(20px);
                ">
                    <h3 style="margin: 0 0 20px; color: #FFD700; text-align: center;">${student.name}åŒå­¦è¯¦æƒ…</h3>
                    <div style="display: grid; gap: 16px;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                            <div style="text-align: center; padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: 600; color: #FFD700;">${student.blessingCount}</div>
                                <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6);">æ”¶åˆ°ç¥ç¦</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: 600; color: #FFD700;">${student.averageScore}</div>
                                <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6);">å¹³å‡åˆ†</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: 600; color: #FFD700;">ç¬¬${student.examRank}å</div>
                                <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6);">æ¨¡è€ƒæ’å</div>
                            </div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 8px;">
                            <div style="color: rgba(255, 255, 255, 0.8); margin-bottom: 8px;"><strong>åŸºæœ¬ä¿¡æ¯</strong></div>
                            <div style="color: rgba(255, 255, 255, 0.6); font-size: 14px; line-height: 1.5;">
                                <div>å­¦æ ¡ï¼š${student.school}</div>
                                <div>ç­çº§ï¼š${student.grade}</div>
                                <div>ç§‘ç›®ï¼š${student.subjects}</div>
                                <div>åœ¨çº¿çŠ¶æ€ï¼š${student.isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿'}</div>
                                ${student.isVip ? '<div style="color: #FFD700;">â­ VIPè€ƒç”Ÿ</div>' : ''}
                            </div>
                        </div>
                        <button onclick="closeStudentDetails()" style="
                            padding: 12px;
                            background: linear-gradient(135deg, #FFD700, #FF8C42);
                            border: none;
                            border-radius: 8px;
                            color: #0f0f23;
                            font-weight: 600;
                            cursor: pointer;
                        ">å…³é—­</button>
                    </div>
                </div>
            `;

            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };

            document.body.appendChild(modal);

            // æ·»åŠ å…³é—­å‡½æ•°åˆ°å…¨å±€ä½œç”¨åŸŸ
            window.closeStudentDetails = function () {
                modal.remove();
            };
        }

        // é¡µé¢è¿‡æ¸¡æ•ˆæœ
        function pageTransition(targetPage, callback) {
            const phoneScreen = document.querySelector('.phone-screen');
            phoneScreen.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
            phoneScreen.style.transform = 'scale(0.95)';
            phoneScreen.style.opacity = '0.7';

            setTimeout(() => {
                if (callback) callback();
                window.location.href = targetPage;
            }, 150);
        }

        // å¯¼èˆªåŠŸèƒ½
        function goToHome() {
            updateNavState(0);
            showToast('åˆ‡æ¢åˆ°é¦–é¡µ...');
            pageTransition('blessing-main.html');
        }

        function goToBlessingWall() {
            updateNavState(1);
            showToast('åˆ‡æ¢åˆ°ç¥ˆç¦å¢™...');
            pageTransition('blessing-wall.html');
        }

        function goToProfile() {
            updateNavState(3);
            showToast('åˆ‡æ¢åˆ°ä¸ªäººä¸­å¿ƒ...');
            pageTransition('personal-center.html');
        }

        // æ›´æ–°å¯¼èˆªçŠ¶æ€
        function updateNavState(activeIndex) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach((item, index) => {
                item.classList.toggle('active', index === activeIndex);
            });
        }

        // Toast æç¤º - å¢å¼ºç‰ˆæœ¬
        function showToast(message, type = 'info', duration = 2000) {
            const toast = document.createElement('div');

            let backgroundColor, textColor, icon;
            switch (type) {
                case 'success':
                    backgroundColor = 'rgba(76, 175, 80, 0.9)';
                    textColor = 'white';
                    icon = 'fas fa-check-circle';
                    break;
                case 'error':
                    backgroundColor = 'rgba(244, 67, 54, 0.9)';
                    textColor = 'white';
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    backgroundColor = 'rgba(255, 193, 7, 0.9)';
                    textColor = '#0f0f23';
                    icon = 'fas fa-exclamation-triangle';
                    break;
                default:
                    backgroundColor = 'rgba(0, 0, 0, 0.8)';
                    textColor = 'white';
                    icon = 'fas fa-info-circle';
            }

            toast.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: ${backgroundColor};
                color: ${textColor};
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                display: flex;
                align-items: center;
                gap: 8px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
                opacity: 0;
                transition: opacity 0.3s ease;
            `;

            toast.innerHTML = `
                <i class="${icon}" style="font-size: 16px;"></i>
                ${message}
            `;

            document.body.appendChild(toast);

            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                toast.style.opacity = '1';
            }, 10);

            // éšè—åŠ¨ç”»
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }        // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æ›´æ–°
        function updateStats() {
            setInterval(() => {
                // éšæœºæ›´æ–°ç¥ç¦æ•°é‡
                const randomStudentIndex = Math.floor(Math.random() * studentsData.length);
                if (Math.random() > 0.9) { // 10% çš„æ¦‚ç‡æ›´æ–°
                    const student = studentsData[randomStudentIndex];
                    StudentDataManager.updateBlessingCount(student.name);

                    // é‡æ–°åŠ è½½æ•°æ®å¹¶æ›´æ–°UI
                    studentsData = StudentDataManager.getStudentData();
                    if (filteredStudents.length === studentsData.length) {
                        filteredStudents = [...studentsData];
                        renderStudentList();
                        updateStatistics();
                    }
                }
            }, 30000); // 30ç§’æ›´æ–°ä¸€æ¬¡
        }        // åˆå§‹åŒ–å®æ—¶æ•°æ®æ›´æ–°
        updateStats();

        // ===== åº•éƒ¨å¯¼èˆªåŠŸèƒ½ =====
        function goToHome() {
            showToast('è·³è½¬åˆ°é¦–é¡µ...');
            pageTransition('blessing-main.html');
        }

        function goToBlessingWall() {
            showToast('è·³è½¬åˆ°ç¥ˆç¦å¢™...');
            pageTransition('blessing-wall.html');
        }

        function goToProfile() {
            showToast('è·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ...');
            pageTransition('personal-center.html');
        }

        // é¡µé¢è·³è½¬åŠ¨ç”»
        function pageTransition(url) {
            document.body.style.transition = 'opacity 0.3s ease';
            document.body.style.opacity = '0';
            setTimeout(() => {
                window.location.href = url;
            }, 300);
        }

        // ===== é¡µé¢å¸è½½æ—¶åŒæ­¥æ•°æ® =====
        window.addEventListener('beforeunload', function () {
            // ç¡®ä¿åœ¨é¡µé¢å…³é—­å‰åŒæ­¥æ•°æ®
            DataSyncManager.syncToAllPages();
        });

        // ===== ç›‘å¬å­˜å‚¨å˜åŒ– =====
        window.addEventListener('storage', function (e) {
            if (e.key === 'blessing_students') {
                // å½“å…¶ä»–é¡µé¢æ›´æ–°å­¦ç”Ÿæ•°æ®æ—¶ï¼Œé‡æ–°åŠ è½½å½“å‰é¡µé¢æ•°æ®
                console.log('ğŸ“¡ æ£€æµ‹åˆ°å­¦ç”Ÿæ•°æ®æ›´æ–°ï¼Œé‡æ–°åŠ è½½...');
                loadStudentsData();
                renderStudentList();
                updateStatistics();
            }
        });

        // åˆ é™¤å­¦ç”Ÿ
        function removeStudent(studentId, studentName) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤å­¦ç”Ÿ ${studentName} å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`)) {
                try {
                    const remainingStudents = StudentDataManager.removeStudent(studentId);

                    // æ›´æ–°æœ¬åœ°æ•°æ®
                    studentsData = remainingStudents;
                    filteredStudents = [...studentsData];

                    // é‡æ–°æ¸²æŸ“åˆ—è¡¨
                    renderStudentList();
                    updateStatistics();

                    // åŒæ­¥åˆ°å…¶ä»–é¡µé¢
                    DataSyncManager.syncToAllPages();

                    showToast(`å·²åˆ é™¤å­¦ç”Ÿ ${studentName}`, 'success');
                    console.log(`âœ… æˆåŠŸåˆ é™¤å­¦ç”Ÿ: ${studentName}`);
                } catch (error) {
                    console.error('âŒ åˆ é™¤å­¦ç”Ÿå¤±è´¥:', error);
                    showToast('åˆ é™¤å­¦ç”Ÿå¤±è´¥', 'error');
                }
            }
        }

        // æ‰¹é‡åˆ é™¤å­¦ç”Ÿ
        function batchDeleteStudents() {
            const selectedCards = document.querySelectorAll('.student-card.selected');
            if (selectedCards.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„å­¦ç”Ÿ', 'warning');
                return;
            }

            const studentNames = Array.from(selectedCards).map(card => {
                const nameElement = card.querySelector('.student-name');
                return nameElement.textContent.replace('åŒå­¦', '');
            });

            if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${studentNames.length} ä½å­¦ç”Ÿå—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚\n\nå­¦ç”Ÿåˆ—è¡¨ï¼š\n${studentNames.join(', ')}`)) {
                let deletedCount = 0;
                selectedCards.forEach(card => {
                    const studentId = card.dataset.studentId;
                    const studentName = studentNames[deletedCount];

                    try {
                        StudentDataManager.removeStudent(parseInt(studentId));
                        deletedCount++;
                    } catch (error) {
                        console.error(`åˆ é™¤å­¦ç”Ÿ ${studentName} å¤±è´¥:`, error);
                    }
                });

                // é‡æ–°åŠ è½½æ•°æ®
                studentsData = StudentDataManager.getStudentData();
                filteredStudents = [...studentsData];
                renderStudentList();
                updateStatistics();
                DataSyncManager.syncToAllPages();

                showToast(`æˆåŠŸåˆ é™¤ ${deletedCount} ä½å­¦ç”Ÿ`, 'success');
                toggleBatchMode(false);
            }
        }

        // å¯¼å‡ºå­¦ç”Ÿæ•°æ®
        function exportStudentData() {
            try {
                const students = StudentDataManager.getStudentData();
                const exportData = {
                    exportDate: new Date().toISOString(),
                    totalStudents: students.length,
                    students: students.map(student => ({
                        ...student,
                        exportNote: 'æ¥è‡ªé«˜è€ƒç¥ˆç¦åº”ç”¨'
                    }))
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);

                const link = document.createElement('a');
                link.href = url;
                link.download = `å­¦ç”Ÿæ•°æ®å¯¼å‡º_${new Date().toLocaleDateString()}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showToast(`æˆåŠŸå¯¼å‡º ${students.length} ä½å­¦ç”Ÿæ•°æ®`, 'success');
            } catch (error) {
                console.error('å¯¼å‡ºæ•°æ®å¤±è´¥:', error);
                showToast('å¯¼å‡ºæ•°æ®å¤±è´¥', 'error');
            }
        }

        // æ‰¹é‡æ“ä½œæ¨¡å¼åˆ‡æ¢
        function toggleBatchMode(enable = null) {
            const isEnabled = enable !== null ? enable : !document.body.classList.contains('batch-mode');

            if (isEnabled) {
                document.body.classList.add('batch-mode');
                showToast('è¿›å…¥æ‰¹é‡æ“ä½œæ¨¡å¼ï¼Œç‚¹å‡»å­¦ç”Ÿå¡ç‰‡é€‰æ‹©', 'info');

                // æ·»åŠ æ‰¹é‡æ“ä½œå·¥å…·æ 
                showBatchToolbar();
            } else {
                document.body.classList.remove('batch-mode');
                document.querySelectorAll('.student-card.selected').forEach(card => {
                    card.classList.remove('selected');
                });
                hideBatchToolbar();
            }
        }

        // æ˜¾ç¤ºæ‰¹é‡æ“ä½œå·¥å…·æ 
        function showBatchToolbar() {
            // ç§»é™¤ç°æœ‰å·¥å…·æ 
            const existingå·¥å…·æ  = document.querySelector('.batch-toolbar');
            if (existingToolbar) {
                existingToolbar.remove();
            }

            const toolbar = document.createElement('div');
            toolbar.className = 'batch-toolbar';
            toolbar.innerHTML = `
                <button class="delete-btn" onclick="batchDeleteStudents()">
                    <i class="fas fa-trash"></i> åˆ é™¤é€‰ä¸­
                </button>
                <button class="export-btn" onclick="exportStudentData()">
                    <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®
                </button>
                <button class="cancel-btn" onclick="toggleBatchMode(false)">
                    <i class="fas fa-times"></i> å–æ¶ˆ
                </button>
            `;

            document.body.appendChild(toolbar);
        }

        // éšè—æ‰¹é‡æ“ä½œå·¥å…·æ 
        function hideBatchToolbar() {
            const toolbar = document.querySelector('.batch-toolbar');
            if (toolbar) {
                toolbar.style.animation = 'slideDownFade 0.3s ease forwards';
                setTimeout(() => toolbar.remove(), 300);
            }
        }

        // æ·»åŠ ä¸€ä¸ªé•¿æŒ‰å¯åŠ¨æ‰¹é‡æ¨¡å¼çš„åŠŸèƒ½
        function addLongPressSupport() {
            let longPressTimer;
            const longPressDuration = 800; // 800ms é•¿æŒ‰

            document.addEventListener('touchstart', function (e) {
                const studentCard = e.target.closest('.student-card');
                if (studentCard && !document.body.classList.contains('batch-mode')) {
                    longPressTimer = setTimeout(() => {
                        toggleBatchMode(true);
                        studentCard.classList.add('selected');
                        navigator.vibrate && navigator.vibrate(50); // è§¦è§‰åé¦ˆ
                    }, longPressDuration);
                }
            });

            document.addEventListener('touchend', function () {
                clearTimeout(longPressTimer);
            });

            document.addEventListener('touchmove', function () {
                clearTimeout(longPressTimer);
            });
        }        // åˆå§‹åŒ–å­¦ç”Ÿå¡ç‰‡é€‰æ‹©äº‹ä»¶
        function bindStudentCardSelectEvents() {
            document.addEventListener('click', function (e) {
                const studentCard = e.target.closest('.student-card');
                if (studentCard && document.body.classList.contains('batch-mode')) {
                    e.preventDefault();
                    e.stopPropagation();
                    studentCard.classList.toggle('selected');

                    // æ›´æ–°å·¥å…·æ æŒ‰é’®çŠ¶æ€
                    const selectedCount = document.querySelectorAll('.student-card.selected').length;
                    const deleteBtn = document.querySelector('.batch-toolbar .delete-btn');
                    if (deleteBtn) {
                        deleteBtn.innerHTML = `<i class="fas fa-trash"></i> åˆ é™¤é€‰ä¸­ (${selectedCount})`;
                    }
                }
            });
        }

        // é«˜çº§æ•°æ®ç®¡ç†åŠŸèƒ½
        const AdvancedDataManager = {
            // æ•°æ®éªŒè¯
            validateStudentData(student) {
                const required = ['name', 'school', 'grade', 'subjects'];
                return required.every(field => student[field] && student[field].trim());
            },

            // æ•°æ®æ¸…ç†
            cleanupData() {
                const students = StudentDataManager.getStudentData();
                const cleaned = students.filter(student => this.validateStudentData(student));

                if (cleaned.length !== students.length) {
                    StudentDataManager.saveStudentData(cleaned);
                    showToast(`æ¸…ç†äº† ${students.length - cleaned.length} æ¡æ— æ•ˆæ•°æ®`, 'info');
                }

                return cleaned;
            },

            // å¯¼å…¥æ•°æ®
            importData(jsonData) {
                try {
                    const data = JSON.parse(jsonData);
                    if (data.students && Array.isArray(data.students)) {
                        const validStudents = data.students.filter(s => this.validateStudentData(s));
                        StudentDataManager.saveStudentData(validStudents);
                        loadStudentsData();
                        renderStudentList();
                        updateStatistics();
                        showToast(`æˆåŠŸå¯¼å…¥ ${validStudents.length} ä½å­¦ç”Ÿ`, 'success');
                        return true;
                    }
                } catch (error) {
                    console.error('å¯¼å…¥æ•°æ®å¤±è´¥:', error);
                    showToast('å¯¼å…¥æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                }
                return false;
            }
        };

        // å®šæœŸæ•°æ®æ¸…ç†
        setInterval(() => {
            AdvancedDataManager.cleanupData();
        }, 300000); // 5åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡

        bindStudentCardSelectEvents();

        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨é•¿æŒ‰æ”¯æŒ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', addLongPressSupport);
        } else {
            addLongPressSupport();
        }

        // ===== æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒå¢å¼º =====
        const PerformanceOptimizer = {
            // è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–ï¼ˆå½“å­¦ç”Ÿæ•°é‡å¾ˆå¤šæ—¶ï¼‰
            virtualScrollThreshold: 50,
            visibleItemsCount: 10,

            enableVirtualScroll() {
                if (filteredStudents.length < this.virtualScrollThreshold) {
                    return false; // æ•°æ®é‡ä¸å¤§ï¼Œä¸éœ€è¦è™šæ‹Ÿæ»šåŠ¨
                }

                console.log('ğŸ“Š å¯ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–');
                // è¿™é‡Œå¯ä»¥å®ç°è™šæ‹Ÿæ»šåŠ¨é€»è¾‘
                return true;
            },

            // é˜²æŠ–æœç´¢
            debounceSearch: null,

            optimizedSearch(searchTerm) {
                clearTimeout(this.debounceSearch);
                this.debounceSearch = setTimeout(() => {
                    applySearch(searchTerm, true);
                }, 300);
            },

            // å›¾ç‰‡æ‡’åŠ è½½ï¼ˆå¦‚æœæœ‰å¤´åƒå›¾ç‰‡ï¼‰
            enableLazyLoad() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (img.dataset.src) {
                                img.src = img.dataset.src;
                                img.removeAttribute('data-src');
                                observer.unobserve(img);
                            }
                        }
                    });
                });

                document.querySelectorAll('img[data-src]').forEach(img => {
                    observer.observe(img);
                });
            }
        };

        // ===== ç”¨æˆ·åå¥½è®¾ç½® =====
        const UserPreferences = {
            getSettings() {
                return JSON.parse(localStorage.getItem('student_management_settings') || '{}');
            },

            saveSetting(key, value) {
                const settings = this.getSettings();
                settings[key] = value;
                localStorage.setItem('student_management_settings', JSON.stringify(settings));
            },

            getSetting(key, defaultValue = null) {
                const settings = this.getSettings();
                return settings[key] !== undefined ? settings[key] : defaultValue;
            },

            // åº”ç”¨ç”¨æˆ·åå¥½
            applyPreferences() {
                // æ¢å¤ä¸Šæ¬¡çš„ç­›é€‰æ¡ä»¶
                const lastFilter = this.getSetting('lastFilter', 'all');
                if (lastFilter !== 'all') {
                    setTimeout(() => applyFilter(lastFilter), 100);
                }

                // æ¢å¤æ’åºåå¥½
                const sortOrder = this.getSetting('sortOrder', 'default');
                if (sortOrder !== 'default') {
                    this.applySorting(sortOrder);
                }
            },

            // åº”ç”¨æ’åº
            applySorting(order) {
                switch (order) {
                    case 'name':
                        filteredStudents.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                    case 'blessing':
                        filteredStudents.sort((a, b) => b.blessingCount - a.blessingCount);
                        break;
                    case 'score':
                        filteredStudents.sort((a, b) => b.averageScore - a.averageScore);
                        break;
                    default:
                        return;
                }
                renderStudentList();
                this.saveSetting('sortOrder', order);
            }
        };

        // ===== æ— éšœç¢è®¿é—®æ”¯æŒ =====
        const AccessibilityEnhancer = {
            init() {
                // é”®ç›˜å¯¼èˆªæ”¯æŒ
                this.enableKeyboardNavigation();

                // å±å¹•é˜…è¯»å™¨æ”¯æŒ
                this.enhanceScreenReaderSupport();

                // é«˜å¯¹æ¯”åº¦æ¨¡å¼æ£€æµ‹
                this.detectHighContrast();
            },

            enableKeyboardNavigation() {
                document.addEventListener('keydown', (e) => {
                    const focusedCard = document.querySelector('.student-card:focus');

                    switch (e.key) {
                        case 'ArrowDown':
                            this.focusNextCard(focusedCard);
                            e.preventDefault();
                            break;
                        case 'ArrowUp':
                            this.focusPrevCard(focusedCard);
                            e.preventDefault();
                            break;
                        case 'Enter':
                        case ' ':
                            if (focusedCard) {
                                focusedCard.click();
                                e.preventDefault();
                            }
                            break;
                        case 'Escape':
                            if (document.body.classList.contains('batch-mode')) {
                                toggleBatchMode(false);
                            }
                            break;
                    }
                });
            },

            focusNextCard(current) {
                const cards = Array.from(document.querySelectorAll('.student-card'));
                const index = cards.indexOf(current);
                const next = cards[index + 1] || cards[0];
                if (next) {
                    next.focus();
                    next.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            },

            focusPrevCard(current) {
                const cards = Array.from(document.querySelectorAll('.student-card'));
                const index = cards.indexOf(current);
                const prev = cards[index - 1] || cards[cards.length - 1];
                if (prev) {
                    prev.focus();
                    prev.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            },

            enhanceScreenReaderSupport() {
                // ä¸ºå­¦ç”Ÿå¡ç‰‡æ·»åŠ ariaæ ‡ç­¾
                document.addEventListener('DOMContentLoaded', () => {
                    document.querySelectorAll('.student-card').forEach((card, index) => {
                        card.setAttribute('tabindex', '0');
                        card.setAttribute('role', 'button');
                        card.setAttribute('aria-label', `å­¦ç”Ÿå¡ç‰‡ ${index + 1}`);
                    });
                });
            },

            detectHighContrast() {
                if (window.matchMedia('(prefers-contrast: high)').matches) {
                    document.body.classList.add('high-contrast');
                }
            }
        };

        // ===== åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½ =====
        function initializeAdvancedFeatures() {
            // åº”ç”¨ç”¨æˆ·åå¥½
            UserPreferences.applyPreferences();

            // åˆå§‹åŒ–æ— éšœç¢åŠŸèƒ½
            AccessibilityEnhancer.init();

            // ä¼˜åŒ–æœç´¢è¾“å…¥
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.removeEventListener('input', searchStudents);
                searchInput.addEventListener('input', (e) => {
                    PerformanceOptimizer.optimizedSearch(e.target.value.toLowerCase().trim());
                });
            }

            console.log('ğŸš€ é«˜çº§åŠŸèƒ½å·²åˆå§‹åŒ–');
        }

        // ===== æ•°æ®ç»Ÿè®¡å’Œåˆ†æ =====
        const AnalyticsManager = {
            generateReport() {
                const students = StudentDataManager.getStudentData();
                const stats = StudentDataManager.getStatistics();

                const report = {
                    totalStudents: students.length,
                    vipStudents: stats.vipStudents,
                    onlineStudents: stats.onlineStudents,
                    totalBlessings: stats.totalBlessings,
                    averageBlessings: Math.round(stats.totalBlessings / students.length),
                    subjects: this.getSubjectDistribution(students),
                    schools: this.getSchoolDistribution(students),
                    topStudents: this.getTopStudents(students)
                };

                return report;
            },

            getSubjectDistribution(students) {
                const distribution = {};
                students.forEach(student => {
                    distribution[student.subjects] = (distribution[student.subjects] || 0) + 1;
                });
                return distribution;
            },

            getSchoolDistribution(students) {
                const distribution = {};
                students.forEach(student => {
                    distribution[student.school] = (distribution[student.school] || 0) + 1;
                });
                return Object.entries(distribution)
                    .sort(([, a], [, b]) => b - a)
                    .slice(0, 5)
                    .reduce((acc, [school, count]) => {
                        acc[school] = count;
                        return acc;
                    }, {});
            },

            getTopStudents(students) {
                return students
                    .sort((a, b) => b.blessingCount - a.blessingCount)
                    .slice(0, 3)
                    .map(s => ({ name: s.name, blessings: s.blessingCount }));
            },

            showReport() {
                const report = this.generateReport();
                console.log('ğŸ“ˆ å­¦ç”Ÿç®¡ç†ç»Ÿè®¡æŠ¥å‘Š:', report);

                showToast(`ç»Ÿè®¡å®Œæˆï¼š${report.totalStudents}ä½å­¦ç”Ÿï¼Œ${report.totalBlessings}ä¸ªç¥ç¦`, 'success', 3000);
            }
        };

        // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–é«˜çº§åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function () {
            initializeAdvancedFeatures();
        });

        // é¡µé¢å¸è½½å‰ä¿å­˜ç”¨æˆ·åå¥½
        window.addEventListener('beforeunload', function () {
            UserPreferences.saveSetting('lastFilter', currentFilter);
            UserPreferences.saveSetting('lastSearch', document.getElementById('searchInput')?.value || '');
        });
    </script>
</body>
</html>